(function(){function q(a){var c=(Date.parse(new Date)-a)/1E3,b=parseInt(c/86400),d=parseInt(c/3600),e=parseInt(c/60),c=parseInt(c);if(0<b&&4>b)return b+"\u5929\u524d";if(0>=b&&0<d)return d+"\u5c0f\u65f6\u524d";if(0>=d&&0<e)return e+"\u5206\u949f\u524d";if(0>=e&&0<=c)return"\u521a\u521a\u4e4b\u524d";a=new Date(a);return a.getFullYear()+"\u5e74"+(a.getMonth()+1)+"\u6708"+a.getDate()+"\u65e5 "+a.getHours()+"::"+a.getMinutes()+":"+a.getSeconds()}function t(a,c){this.ele=$(a);var b=$(a).attr("id");b||
(b="listLoading"+Math.random().toString().replace("0.",""),$(a).attr("id",b));this.id=b;this.children=$($(a).get(0).children[0]);this.pullUpId="pullUp-"+this.id;this.pullDownId="pullDown-"+this.id;this.init(c)}var k=function(){var a,c,b,d;c={};d=this;a=function(a,b){var d;return(null!=(d=c[a])?d:c[a]=[]).push(b)};b=function(a){var b;return null!=(b=c[a])?b.length=0:void 0};return{listen:a,one:function(c,d){b(c);return a(c,d)},remove:b,trigger:function(){var a,b,g,n;b=Array.prototype.shift.call(arguments);
b=null!=(a=c[b])?a:c[b]=[];g=0;for(n=b.length;g<n;g++)if(a=b[g],void 0==a||!1===a.apply(d,arguments))return!1}}}();$.fn.listloading=function(a){return new t(this,a)};t.prototype={version:"1.0.0",init:function(a){this.options={};this.options.upLoadmoretxt='<i class="icon-up"></i>\u4e0a\u62c9\u52a0\u8f7d\u66f4\u591a';this.options.pullDrefreshtxt='<i class="icon-down"></i>\u4e0b\u62c9\u52a0\u8f7d\u66f4\u591a';this.options.loadertxt='<i class="icon-loading"></i>\u6b63\u5728\u52a0\u8f7d\u66f4\u591a';this.options.Realtimetxt=
"\u677e\u5f00\u5237\u65b0";this.options.loaderendtxt="\u5df2\u663e\u793a\u5b8c\u5168\u90e8";this.options.windowHeight=$(window).height();this.options.windowWidth=$(window).width();this.options.viewHeight=this.ele.height();this.options.pullUpActionStr="pullUpActionStr"+this.id;this.options.pullDownActionStr="pullDownAction"+this.id;k.remove(this.options.pullUpActionStr);k.remove(this.options.pullDownActionStr);$.extend(this.options,a);this.render()},render:function(){this.pullDownAction()},destroy:function(){$(this.children).css({"-webkit-transform":"",
transform:""});$("#"+this.pullDownId+", #"+this.pullUpId).remove();this.iscroll.destroy()},refresh:function(a){this.createPullUpEle(a)},createPullUpEle:function(a){var c=this.options,b=this.children;b.css("min-height","auto");var d=b.height(),e=this.pullUpId,f=this.iscroll;c.minScrollHeight=c.viewHeight+c.pullDownOffset;this.pullUpEle?d<c.minScrollHeight&&(this.pullUpEle.remove(),this.pullUpEle=null,this.options.pullUpOffset=0,b.css("min-height",c.minScrollHeight)):$.isFunction(c.pullUpAction)&&d>
c.minScrollHeight?(b.append('<div id="'+e+'" data-class="pullUpId"><span class="pullUpLabel inlineblock-span">'+c.upLoadmoretxt+"</span></div>"),this.pullUpEle=$("#"+e),c.pullUpOffset=this.pullUpEle.get(0).offsetHeight):b.css("min-height",c.minScrollHeight);f&&(this.pullUpEle&&!a&&this.pullUpEle.height(0),f.refresh(),this.pullUpEle&&!a&&(this.pullUpEle.removeAttr("style"),f.maxScrollY-=this.options.pullUpOffset),0!==f.y||a||this.resizeAnimate())},createPullIScroll:function(){var a=this.options,c=
"";a.disableTime&&(a.endDate=Date.parse(new Date),c='<span class="time">\u6700\u540e\u66f4\u65b0\u65f6\u95f4\uff1a<em id="'+this.id+'time-em">'+q(a.endDate)+"</em></span>");a=$('<div id="'+this.pullDownId+'" data-class="pullDownId">\t<span class="pullDownLabel inlineblock-span">'+a.pullDrefreshtxt+"</span>"+c+"</div>");a.prependTo(this.children);this.pullDownEle=a;this.options.pullDownOffset=a.get(0)?a.get(0).offsetHeight:0;this.createPullUpEle()},toggleClassText:function(a,c,b,d){a.attr("class",
c).find("."+b).html(d)},resizeAnimate:function(a){var c=this.iscroll,b=this.options.pullDownOffset;a?(b=-c.maxScrollY-b,-a<=b&&(a=-b)):a=-b;c.scrollTo(0,a,300,IScroll.utils.ease.quadratic)},scrollEvent:function(){var a=this,c=this.options,b=this.iscroll,d=this.pullDownEle,e=this.toggleClassText,f=c.pullDrefreshtxt,g=c.upLoadmoretxt,n=c.Realtimetxt,m=c.loadertxt,h=-c.pullDownOffset;b.on("scrollStart",function(){var b=a.pullUpEle;a.startPullTime=(new Date).getTime();c.disableTime&&$("#"+a.id+"time-em").html(q(c.endDate));
d&&d.hasClass("loading")?e(d,"","pullDownLabel",f):b&&b.hasClass("loading")&&e(b,"","pullUpLabel",g)});b.on("scrollMove",function(){var b=this.y,c=this.maxScrollY,l=a.pullUpEle,r=d.hasClass("flip"),u=l&&l.hasClass("flip");5<b&&!r?e(d,"flip","pullDownLabel",'<i class="icon-up"></i>'+n):5>b&&r?e(d,"","pullDownLabel",f):l&&b<c-5&&!u?e(l,"flip","pullUpLabel",'<i class="icon-down"></i>'+n):l&&b>c+5&&u&&e(l,"","pullUpLabel",g)});b.on("scrollEnd",function(){var b=this.y,f=this.maxScrollY,l=a.pullUpEle,r=
new Date;b===f&&l&&e(l,"flip","pullUpLabel",n);a.endPullTime=r.getTime();a.totalGapTime=a.endPullTime-a.startPullTime;a.options.endDate=Date.parse(r);200>a.totalGapTime?b>h&&1>b&&a.resizeAnimate():d&&d.hasClass("flip")?(e(d,"loading","pullDownLabel",m),a.pullDownAction()):l&&l.hasClass("flip")?(e(l,"loading","pullUpLabel",m),a.pullUpAction()):b>h&&1>b?a.resizeAnimate():-f>=-b&&f+c.pullUpOffset>b&&a.resizeAnimate(f+c.pullUpOffset)})},pullDownAction:function(){var a=(new Date).getTime()-this.startPullTime,
c=this,b=this.options,d=b.pullDownAction,e=b.pullDownActionStr;$.isFunction(d)&&(this.iscroll||(k.listen(e,function(){c.createPullIScroll();var a={startY:-b.pullDownOffset,listLoading:!0};$.extend(a,b.iscrollOptions);c.iscroll=new IScroll("#"+c.id,a);c.scrollEvent();k.remove(e)}),d(function(){k.trigger(e)})),400<=a&&(k.listen(e,function(){c.refresh(!0);var a=c.pullUpEle;a?a.find(".pullUpLabel").html(b.upLoadmoretxt):c.createPullUpEle();c.resizeAnimate();c.iscroll.refresh();k.remove(e)}),d(function(){k.trigger(e)})))},
pullUpAction:function(){var a=(new Date).getTime()-this.startPullTime,c=this,b=this.options,d=b.pullUpAction,e=b.pullUpActionStr,f=c.iscroll;if($.isFunction(d)){var g=f.y+b.pullUpOffset;400<=a?(k.listen(e,function(){c.refresh(!0);var a=c.pullUpEle,d=b.loaderendtxt;b.pullEnd?c.resizeAnimate(g):(d=b.upLoadmoretxt,f.refresh());a.find(".pullUpLabel").html(d);k.remove(e)}),d(function(a){b.pullEnd=a;k.trigger(e)})):c.resizeAnimate(g)}},evt:function(a,c,b,d){var e="ontouchstart"in window,f=e?"touchstart":
"mousedown",g=e?"touchend":"mouseup",k=e?"touchmove":"mousemove",e=e?"touchleave":"mouseout",m=function(a){var b={},c=a.originalEvent;void 0==c&&(c=a);c.changedTouches?(b.pageX=c.changedTouches[0].pageX,b.pageY=c.changedTouches[0].pageY,b.clientX=c.changedTouches[0].clientX,b.clientY=c.changedTouches[0].clientY):(b.pageX=a.pageX,b.pageY=a.pageY,b.clientX=a.clientX,b.clientY=a.clientY);b.evt=a;return b},h=this.ele;void 0==d&&(d=!0);switch(c){case "mousemove":case "touchmove":d&&h.off(k,a);h.on(k,a,
function(a){var c=$(this);a=m(a);b(c,a)});break;case "click":case "tap":var p,q=function(a,c,d){d=m(c);Date.now();d={x:d.clientX,y:d.clientY};d=p&&d?Math.sqrt((p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y)):0;20>d&&(c=m(c),b(a,c))};d&&(h.off(f,a),h.off(g,a));h.on(f,a,function(a){2!=a.button&&(a=m(a),p={x:a.clientX,y:a.clientY})});h.on(g,a,function(a){if(2!=a.button){var c=$(this);q(c,a,b)}});break;case "mousedown":case "touchstart":d&&h.off(f,a);h.on(f,a,function(a){var c=$(this);a=m(a);b(c,a)});break;case "mouseup":case "touchend":d&&
h.off(g,a);h.on(g,a,function(a){var c=$(this);a=m(a);b(c,a)});break;case "mouseout":d&&h.off(e,a),h.on(e,a,function(a){q(a,b)})}}}})(window.Zepto||window.jQuery);